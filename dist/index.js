!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).asyncScheme=n()}(this,function(){"use strict";function l(o){var i=[];return function e(n,r){0!=n.length&&i.push(n.slice());for(var t=r;t<o.length;t++)n.push(o[t]),e(n,t+1),n.pop()}([],0),i}function a(e){return e.join("&")}var u={},t={},o={};function e(){this.addKey=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(""!==e){e=Array.isArray(e)?e.concat(n):function(e,n,r){if(r||2===arguments.length)for(var t,o=0,i=n.length;o<i;o++)!t&&o in n||((t=t||Array.prototype.slice.call(n,0,o))[o]=n[o]);return e.concat(t||Array.prototype.slice.call(n))}([e],n,!0);for(var t=0;t<=e.length;t++)if(u.hasOwnProperty(e[t]))throw new Error("【addKey】：该 key: ".concat(e[t]," 已经被注册了，请添加其他的 key 值"));for(var o=l(e).filter(function(e){return 1==e.length}),i=l(e).filter(function(e){return 1<e.length}),t=0;t<o.length;t++){var c=a(o[t]);u[c]=this._pendingPromise(c)}for(t=0;t<i.length;t++){var c=a(i[t].sort()),f=i[t].map(function(e){return u[e]});u[c]=Promise.all(f)}}}}return e.prototype._pendingPromise=function(r){return new Promise(function(e,n){o[r]="pending",t[r]=e})},e.prototype.setKeyValue=function(e,n){t.hasOwnProperty(e)?t[e]&&("pending"!=o[e]&&(delete u[e],u[e]=this._pendingPromise(e)),t[e](n),o[e]="fulfilled"):console.error("【setKeyValue】：该 key: ".concat(e," 没有注册，请检查 key 值"))},e.prototype.execAsyncFn=function(e,n){var r,t,o=this;if(Array.isArray(e)){i=e,r=Object.keys(u),t=null,i.map(function(e){if(!r.includes(e))return t=e});var i=t;if(i)throw new Error("【execAsyncFn】：该 key: ".concat(i," 没有注册，请检查 key 值"));e=a(e.sort()),u[e].then(function(e){n.call(o,e)})}else{if(!u.hasOwnProperty(e))throw new Error("【execAsyncFn】：该 key: ".concat(e," 没有注册，请检查 key 值"));u[e].then(function(e){n.call(o,e)})}},e});
